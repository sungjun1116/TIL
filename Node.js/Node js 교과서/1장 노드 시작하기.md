# 1장. 노드 시작하기

# 1.1 핵심개념 이해하기

## 1.1.2 자바스크립트 런타임

- Node.js는 Chrome V8 Javascript 엔진으로 빌드된 Javascript 런타임입니다.
- 런타임: 특정 언어로 만든 프로그램을 실행할 수 있는 환경
- 노드: 자바스크립트 실행기(V8엔진 + libuv라는 라이브러리)

## 1.1.3 이벤트 기반

- 이벤트 기반(event-driven)
    - 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식
    - 클릭, 네트워크 요청
    - 이벤트 리스너에 콜백함수를 등록한다고 표현
- 이벤트 루프(event loop)
    - 여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함술를 호출할지를 판단함
    - 함수 호출 부분을 발견했다면 호출한 함수를 호출 스택에 넣는다.
    - 실행은 호출된 순서와 반대로 실행이 완료된다. 호출 스택을 그려보자
    - anonymous 함수는 처음 실행 시의 전역 컨텍스트(global context)를 의미한다.

        자바 스크립트 코드는 실행 시 기본적으로 전역 컨텍스트 안에서 돌아간다.

    - 함수는 실행되는 동안 호출 스택에 머물러 있다가 실행이 완료되면 호출 스택에서 지워진다.
    - anonymous 컨텍스트까지 실행이 모두 완료되었다면 호출 스택은 비어 있게 된다.
- 백그라운드(background)
    - setTimeout 같은 타이머나 이벤트 리스너들이 대기하는 곳입니다.
    - 자바스크립트가 아닌 다른 언어로 작성된 프로그램이라고 봐도 무방하다.
    - 여러 작업이 동시에 실행될 수 있다.
- 태스크 큐(task queue)
    - 이벤트 발생 후, 백그라운드에서는 태스크 큐로 타이머나 이벤트 리스너의 콜백 함수를 보냅니다. 정해진 순서대로 콜백들이 줄을 서 있으므로 콜백 큐라고도 부릅니다.
    - 콜백들은 보통 완료된 순서대로 줄을 서 있지만 특정한 경우에는 순서가 바뀌기도 합니다.
- setTimeout예제

    ```jsx
    function run() {
    		console.log('3초 후 실행');
    }
    console.log('시작');
    setTimeout(run, 3000);
    console.log('끝');
    ```

    ```
    시작
    끝
    3초 후 실행
    ```

    1. 먼저 전역 컨텍스트가 호출 스택에 들어가고 그 뒤 setTimeout이 호출 스택에 들어감
    2. setTimeout이 먼저 실행되고 실행되면 타이머와 함께 run콜백을 백그라운드로 보내고, setTimeout은 호출 스택에서 빠진다. 그 다음 전역 컨텍스트가 호출 스택에서 빠진다.
    3. 백그라운드에서는 3초 후 run 함수를 태스크 큐로 보낸다.
    4. 호출 스택에서 anonymous까지 실행이 완료되어 호출 스택이 비어 있는 상황에서 이벤트 루프는 호출 스택이 비어 있으면 태스크 큐에서 함수를 하나씩 가져와 호출 스택에 넣고 실행한다.
    5. 이벤트 루프는 태스크 큐에 콜백 함수가 들어올 때까지 계속 대기한다.

    만약 호출 스택에 함수들이 너무 많이 들어 있으면 3초가 지난 후에도 run 함수가 실행되지 않을 수 있다. 이벤트 루프는 호출 스택이 비어 있을 때만 태스크 큐에 있는 run함수를 호출 스택으로 가져오기 때문이다. 이것이 setTimeout의 시간이 정확하지 않을 수도 있는 이유!!

## 1.1.4 논 블로킹 I/O

- 논 블로킹 I /O
    - I/O: 입력/출력을 의미한다. 파일 시스템 접근(파일 읽기, 파일 쓰기, 폴더 만들기 등)이나 네트워크를 통한 요청 같은 작업이 I/O작업의 일종이다.
    - 논 블로킹: 이전 작업이 완료될 때까지 대기하지 않고 다음 작업을 수행함을 뜻한다.
    - 노드는 I/O작업을 백그라운드로 넘겨 동시에 처리하곤 한다.
    - 동시에 처리할 수 있는 I/O 작업이라도 논 블로킹 방식으로 코딩하지 않으면 의미가 퇴색되므로 논 블로킹 방식으로 코딩하는 습관을 들여야 한다.
    - I/O 작업이 없다고 해서 논 블로킹이 의미가 없는 것은 아니다. 오래 걸리느 작업을 처리해야 하는 경우, 논 블로킹을 통해 실행 순서를 바꿔 줌으로써 그 작업 때문에 간단한 작업들이 대기해야하는 상황을 막을 수 있다.
    - 논 블로킹과 동시가 같은 의미인 것은 아니다. **동시성은 동시 처리가 가능한 작업을 논 블로킹 처리해야 얻을 수 있다.**
    - 3.6.1절에서 동기와 비동기, 블로킹과 논 블로킹의 관계를 코드와 함께 설명한다. 노드에서는 동기와 블로킹이 유사하고 비동기와 논 블로킹이 유사하다고 알아두자
- setTimeout(콜백, 0)
    - 코드를 논 블로킹으로 만들기 위해 사용하는 기법 중 하나입니다. 사실 노드에서는 다른 방식을 주로 사용하긴 합니다(3.4.3절의 setImmediate 참조).
    - 이벤트 루프를 이해했다면, setTimeout의 콜백함수가 태스크 큐로 보내지므로 순서대로 실행되지 않는다는 것을 알 수 있다. 다음작업이 먼저 실행된 후, 오래 걸리는 작업이 완료된다.
    - 밀리초를 0으로 설정했으므로 바로 실행되는 것으로 착각할 수 있지만 브라우저와 노드에서느 기본적인 지연 시간이 있으므로 바로 실행되지 않는다. HTML5 브라우저는 4ms, 노드에서는 1ms의 지연시간이 있다.

## 1.1.5 싱글 스레드

- 프로세스와 쓰레드
    - 프로세스
        - 운영체제에서 할당하는 작업의 단위
        - 노드나 웹 브라우저 같은 프로그램은 개별적인 프로세스
        - 프로세스 간에는 메모리 등의 자원을 공유하지 않는다.
    - 쓰레드
        - 프로세스 내에서 실행되는 흐름의 단위
        - 흐로세스는 스레드를 여러 개 생성해 여러 작업을 동시에 처리 할 수 있습니다.
        - 쓰레드들은 부모프로세스의 자원을 공유하고 같은 주소의 메모리에 접근 가능하므로 데이터를 공유 할 수 있다.
- 싱글스레드 in 노드
    - 노드를 실행하면 먼저 프로세스 하나가 생성된다. 그리고 그 프로세스에서 스레드들을 생성하는데, 이때 내부적으로 스레드를 여러 개 생성한다. 그 중에서 개발자가 직접 제어할 수 있는 스레드는 하나뿐이다.
- 스레드풀과 워커 스레드
    - 스레드풀(Thread Pool): 노드가 특정 동작을 수행할 때 스스로 멀티 스레드를 사용한다. 대표적인 예로 암호화(3.5.5절), 파일 입출력(3.6절), 압축(3.6.2절)등이 있다.
    - 워커 스레드(Worker Thread): 노드 12 버전에서 안정화된 기능으로 노드에서도 멀티 스레드를 사용할 수 있게 되었다. 직접 다수의 스레드를 다룰 수 있으며 CPU작업이 많은 경우 이용한다.
- 멀티 스레딩과 멀티 프로세싱 비교
    - 멀티 스레딩
        - 하나의 프로세스 안에서 여러 개의 스레드 사용
        - CPU작업이 많을 때 사용
        - 프로그래밍이 어려움
        - 3.6.7절 참고
    - 멀티 프로세싱
        - 여러 개의 프로세스 사용
        - I/O 요청이 많을 때 사용
        - 프로그래밍이 비교적 쉬움
        - 4.5절의 cluster모듈과 15.1.5 절의 pm2 패키지 참고

# 1.2 서버로서의 노드

- 노드의 장단점
    - 장점

        멀티 스레드 방식에 비해 적은 컴퓨터 자원 사용

        I/O 작업이 많은 서버로 적합

        멀티 스레드 방식보다 쉬움

        웹 서버가 내장되어 있음

        자바스크립트를 사용함, JSON 형식과 쉽게 호환됨

    - 단점

        기본적으로 싱글 스레드라서 CPU코어를 하나만 사용

        CPU작업이 많은 서버로는 부적합

        하나뿐인 스레드가 멈추지 않도록 관리가 필요함

        서버 규모가 커졌을 때 서버를 관리하기 어려움

        어중간한 성느으

- 노드를 사용하는 기업

    NASA, 에어비엔비, 우버, 넷플릭스, 링크드인

    페이팔, 월마트, 이베이

    네이버, 카카오, 위메프, 아뇰자

# 1.3 서버 외의 노드

- 웹

    Angular, React, Vue

- 모바일

    React Native

- 데스크톱 애플리케이션

    Electron

---

- 초콜리티

[Installing, Upgrading, and Uninstalling Chocolatey](https://chocolatey.org/courses/installation)

윈도에서도 명령 프롬프트를 통해 노드 혹은 노드외의 다른 프로그램을 설치할 수 있게 해준다.